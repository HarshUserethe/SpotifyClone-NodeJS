<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Spotify - Home</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon/icons8-spotify-3d-fluency-32.png">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet" href="/stylesheets/media.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="overlay">
      <div class="popup">
        <h5>Click to Continue</h5>
        <p>If songs not showing, Keep refreshing the page until they appear.</p>
      </div>
    </div>
    <div class="mobile-menu">
      <div class="logo" id="m-logo"><img src="/images/Spotify.svg" alt="" /></div>
      <i class="ri-close-line" id="close"></i>
      <ul>
        <a href="/home" class="mo"
          ><li><i class="ri-home-5-line"></i>Home</li></a
        >
        <a href="/search-page" class="mo"
          ><li><i class="ri-search-line"></i> Search</li></a
        >
        <a href="/library" class="mo"
          ><li><i class="ri-file-list-line"></i>Library</li></a
        >
        <a href="/uploadfile" class="mo"
          ><li>
           
            <i style="margin-left: 0vw" class="ri-add-box-line"></i>Create Music
          </li></a
        >
        <a href="#" class="mo"
          ><li>
            <i style="margin-left: 0vw" class="ri-heart-line"></i>Liked Songs
          </li></a
        >
        <a href="/logout" class="mo"
          ><li><i class="ri-logout-box-r-line"></i>Logout</li></a
        >
      </ul>

      <button><i class="ri-global-line"></i> English</button>
    </div>

    <div class="lyrics">
      <div class="ly-area">
        <p></p>
      </div>
    </div>

    <div class="music-player">
      <div class="for-player"></div>

      <div class="part-1"></div>

      <div class="part-2">
        <div class="control">
          <a href="#" id="shuffle" class="con"
            ><i class="ri-shuffle-line"></i
          ></a>
          <a href="#" id="back" class="con"
            ><i class="ri-skip-back-fill"></i
          ></a>
          <a href="#" id="playbtn"><i class="ri-play-circle-fill"></i></a>
          <a href="#" id="next" class="con"
            ><i class="ri-skip-forward-fill"></i
          ></a>
          <a href="#" id="loop" class="con"><i class="ri-repeat-2-line"></i></a>
        </div>
        <div class="progress">
          <div class="elem-1">0:00</div>
          <div class="elem-2">
            <div class="prog-bar">
              <div class="prog"></div>
            </div>
          </div>
          <div class="elem-3">0:00</div>
        </div>
      </div>

      <div class="part-3">
        <i class="ri-search-eye-line" id="lybtn"></i>
        <div class="sound">
          <a href="#"><i class="ri-volume-down-line"></i></a>
          <input type="range" class="form-range" id="customRange1" />
        </div>
      </div>
    </div>

    <div
      class="main"
      style="width: 100vw; height: 100vh; background-color: #000"
    >
      <div
        class="box-1"
        id="menuOptions"
        style="
          width: 22vw;
          height: 100vh;
          background-color: #000;
          position: fixed;
          z-index: 12;
        "
      >
        <div class="logo"><img src="/images/Spotify.svg" alt="" /></div>
        <div class="elem-cont-1">
          <div class="elem">
            <i class="ri-home-5-line"></i> <a href="/home"><h5>Home</h5></a>
          </div>
          <div class="elem">
            <i class="ri-search-line"></i>
            <a href="/search-page"><h5>Search</h5></a>
          </div>
          <div class="elem">
            <i class="ri-file-list-line"></i>
            <a href="/library"><h5>Library</h5></a>
          </div>
        </div>

        <div class="elem-cont-2">
          <div class="elem newopt">
            <i style="margin-left: 1vw" class="ri-add-box-fill"></i>
            <a href="/uploadfile"
              ><h5 style="width: 140%; margin-left: 1vw">Create Music</h5></a
            >
          </div>
          <div class="elem newopt" id="likePage">
            <i style="margin-left: 1vw" class="ri-heart-fill"></i>
            <a href="#" id="heart"
              ><h5 style="width: 120%; margin-left: 1vw">Liked Songs</h5></a
            >
          </div>
        </div>

        <div class="line"></div>
      </div>

      <div class="box-2" style="width: calc(100vw - 22vw); height: 100vh">
        <div
          class="nav"
          style="
            width: 100%;
            height: 10%;
            background-color: #101010;
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            z-index: 10;
          "
        >
          <div
            class="icon-box"
            id="menuopt"
            style="
              display: flex;
              justify-content: center;
              align-items: center;
              gap: 20px;
            "
          >
            <i
              class="same"
              style="font-size: 2.5vw; color: #ffffffb4; cursor: pointer"
              class="ri-arrow-left-s-line"
            ></i>
            <i
              class="same"
              style="font-size: 2.5vw; color: #ffffffb4; cursor: pointer"
              class="ri-arrow-right-s-line"
            ></i>
            <i
              class="ri-menu-line"
              class="now"
              style="font-size: 6vw; color: #ffffffb4; cursor: pointer"
              id="m-menu"
            ></i>
          </div>
          <div
            class="button-box"
            style="
              display: flex;
              justify-content: center;
              align-items: center;
              gap: 20px;
              margin-left: 30vw;
            "
          >
            <a href="/subscription"><button>Upgrade</button></a>
            <div class="dropdown">
              <button
                style="
                  padding: 6px 25px;
                  border-radius: 500px;
                  display: flex;
                  gap: 1vw;
                  justify-content: center;
                  align-items: center;
                "
                class="btn btn-dark"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <div class="profile-pic">
                  <img
                    src="https://images.unsplash.com/photo-1636622433525-127afdf3662d?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1032&q=80"
                    alt=""
                  />
                </div>
                <span style="position: relative; left: 1.4vw"
                  ><%= user.name %></span
                >
                <i
                  style="position: relative; left: 1vw"
                  class="ri-arrow-down-s-fill"
                ></i>
              </button>
              <ul class="dropdown-menu bg-dark">
                <li>
                  <a style="color: #fff" class="dropdown-item" href="#"
                    >Account <i class="ri-share-box-line"></i
                  ></a>
                </li>
                <li>
                  <a style="color: #fff" class="dropdown-item" href="#"
                    >Profile</a
                  >
                </li>
                <li>
                  <a style="color: #fff" class="dropdown-item" href="#"
                    >Upgrade to premium <i class="ri-share-box-line"></i
                  ></a>
                </li>
                <li>
                  <a style="color: #fff" class="dropdown-item" href="#"
                    >Settings</a
                  >
                </li>
                <hr style="color: #fff" />
                <li>
                  <a style="color: #fff" class="dropdown-item" href="/logout"
                    >Logout</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- FLASH MESSAGE CREATE  -->
        <% if (create.length > 0) { %>
        <div class="alert" style="font-family: circularbook" id="crtMessage">
          <%= create[0] %>
        </div>
        <% } %>

        <div class="album-space">
          <h1
            class="focus"
            style="
              color: #fff;
              position: absolute;
              top: 0vh;
              left: 3vw;
              font-size: 1.8vw;
            "
          >
            Playlist
          </h1>

          <div class="album">
            <div class="play-icon">
              <i
                class="ri-play-circle-fill"
                style="position: absolute; color: #1ed760; font-size: vw"
              ></i>
            </div>
            <div class="album-image">
              <img
                src="https://i.scdn.co/image/ab67616d0000b273303cbd223d0b5133f41b74bc"
                alt=""
              />
            </div>
            <div class="album-title"><h5>Best of Arijit Singh</h5></div>
            <div class="album-desc">
              <p>Arijit singh most played songs on spotify.</p>
            </div>
          </div>

          <div class="album">
            <div class="album-image">
              <img
                src="https://i.scdn.co/image/ab67616d0000b273b568c65985494f973a93955b"
                alt=""
              />
            </div>
            <div class="album-title"><h5>Hindi Retro Launge</h5></div>
            <div class="album-desc">
              <p>Say hey to bollywood best retro music.</p>
            </div>
          </div>

          <a href="/album">
            <div class="album" id="assp">
              <div class="album-image">
                <img
                  src="https://freepsdflyer.com/wp-content/uploads/2021/06/Free-Spotify-Album-Cover-PSD-Template.jpg"
                  alt=""
                />
              </div>
              <div class="album-title"><h5>Tripy Night</h5></div>
              <div class="album-desc">
                <p>Classic Trendy songs playlist 2023.</p>
              </div>
            </div>
          </a>

          <div class="album">
            <div class="album-image">
              <img
                src="https://i.scdn.co/image/ab67616d0000b273a108e07c661f9fc54de9c43a"
                alt=""
              />
            </div>
            <div class="album-title"><h5>Diffrent World</h5></div>
            <div class="album-desc">
              <p>Most played alan walker hits 2023.</p>
            </div>
          </div>

          <div class="album">
            <div class="album-image">
              <img
                src="http://malmusic.com/images/detailed/6/everlasting_Love_songs_sacd.jpg"
                alt=""
              />
            </div>
            <div class="album-title"><h5>Everlasting Love</h5></div>
            <div class="album-desc">
              <p>Bollywood most played romantic songs.</p>
            </div>
          </div>
        </div>

        <div class="songs-space">
          <h1
            class="focus"
            id="mostTrending"
            style="
              color: #fff;
              position: absolute;
              top: 0vh;
              left: 4vw;
              font-size: 1.8vw;
            "
          >
            Most Trending
          </h1>

          <!-- <a href="/play/track/a777.mp3">
      <div class="song">
        <div class="song-image"><img src="https://wallpapercave.com/wp/wp5510430.jpg" alt=""></div>
        <div class="song-title"><h5>Superhit 90's</h5></div>
        <div class="song-desc"><p>Everyone is fan of 90's superhit songs....</p></div>
      </div>
    </a>



      <div class="song">
        <div class="song-image"><img src="https://wallpapercave.com/wp/wp5510430.jpg" alt=""></div>
        <div class="song-title"><h5>Superhit 90's</h5></div>
        <div class="song-desc"><p>Everyone is fan of 90's superhit songs....</p></div>
      </div>



      <div class="song">
        <div class="song-image"><img src="https://wallpapercave.com/wp/wp5510430.jpg" alt=""></div>
        <div class="song-title"><h5>Superhit 90's</h5></div>
        <div class="song-desc"><p>Everyone is fan of 90's superhit songs....</p></div>
      </div>



      <div class="song">
        <div class="song-image"><img src="https://wallpapercave.com/wp/wp5510430.jpg" alt=""></div>
        <div class="song-title"><h5>Superhit 90's</h5></div>
        <div class="song-desc"><p>Everyone is fan of 90's superhit songs....</p></div>
      </div>  -->
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      var songSpace = document.querySelector(".songs-space");
      var audioTrack;
      var trackUrl;

      //BUILDING MUSIC PLAYER ---->

      var playbtn = document.querySelector("#playbtn");
      var backbtn = document.querySelector("#back");
      var nextbtn = document.querySelector("#next");
      var startTime = document.querySelector(".elem-1");
      var totalTime = document.querySelector(".elem-3");
      var progBar = document.querySelector(".prog");
      var part1 = document.querySelector(".part-1");
      var flag = 0;
      var loop = 0;

      //trackAPI      --->
      $.get("/trackapi", function (track) {
        track.forEach(function (item, index) {
          audioTrack = track;
        });
      });

      //GETING SONG DETAILS FROM AN API --->
      // <a href="/play/track/${audioTrack[index].filename}">
      $.get("/songsapi", function (data) {
        data.forEach(function (item, index) {
          songSpace.innerHTML += `
      <div class="song">
        <div class="song-image"><img src="${data[index].songimage}" alt=""></div>
        <div class="song-title"><h5>${data[index].songname}</h5></div>
        <div class="song-desc"><p>${data[index].songdesc}</p></div>
      </div>
     `;
          trackUrl = `/play/track/${audioTrack[index].filename}`;

          var song = document.querySelectorAll(".song");

          song.forEach(function (song, index) {
            song.addEventListener("click", function () {
              //window query max-width 400px
              if (window.matchMedia("(max-width: 400px)").matches) {
                document.querySelector("#playbtn").style.display = "initial";
                document.querySelector(".progress").style.display = "flex";
              }
              if (
                window.matchMedia("(min-width: 401px) and (max-width: 600px)")
                  .matches
              ) {
                document.querySelector("#playbtn").style.display = "initial";
                document.querySelector(".progress").style.display = "flex";
              }

              document.querySelector(
                ".for-player"
              ).innerHTML = `<audio src="/play/track/${audioTrack[index].filename}" controls id="m-player"></audio>`;
              document.querySelector("audio").play();
              playbtn.innerHTML = `<i class="ri-pause-circle-fill"></i>`;

              //NEXT BUTTON TO PLAY NEXT SONG FROM THE LIST
              nextbtn.addEventListener("click", function () {
                loop++;
                document.querySelector(
                  ".for-player"
                ).innerHTML = `<audio src="/play/track/${
                  audioTrack[index + loop].filename
                }" controls id="m-player"></audio>`;
                document.querySelector("audio").play();
                playbtn.innerHTML = `<i class="ri-pause-circle-fill"></i>`;

                //PROGRESS BAR --->
                document
                  .querySelector("audio")
                  .addEventListener("timeupdate", function (event) {
                    const { currentTime, duration } = event.srcElement;

                    let prog_time = (currentTime / duration) * 100;

                    progBar.style.width = `${prog_time}%`;

                    let minute = Math.floor(duration / 60);
                    let seconds = Math.floor(duration % 60);
                    let leadSec = seconds.toString().padStart(2, 0);

                    //total music duration
                    let totalDuration = `${minute}:${leadSec}`;
                    totalTime.textContent = totalDuration;
                    //current music duration
                    let curr_min = Math.floor(currentTime / 60);
                    let curr_sec = Math.floor(currentTime % 60)
                      .toString()
                      .padStart(2, 0);
                    let curr_duration = `${curr_min}:${curr_sec}`;
                    startTime.textContent = curr_duration;

                    //SIDE BAR SONG INDICATOR
                    part1.innerHTML = ` <div class="cover-image"><img src="${
                      data[index + loop].songimage
                    }" alt=""></div>
         <div class="cover-title">${data[index + loop].songname}</div>
         <div class="artist-name">${data[index + loop].artist}</div>`;
                  });
              });
              //PREV BUTTON TO PLAY NEXT SONG FROM THE LIST
              backbtn.addEventListener("click", function () {
                loop--;
                document.querySelector(
                  ".for-player"
                ).innerHTML = `<audio src="/play/track/${
                  audioTrack[index - loop].filename
                }" controls id="m-player"></audio>`;
                document.querySelector("audio").play();
                playbtn.innerHTML = `<i class="ri-pause-circle-fill"></i>`;

                //PROGRESS BAR --->
                document
                  .querySelector("audio")
                  .addEventListener("timeupdate", function (event) {
                    const { currentTime, duration } = event.srcElement;

                    let prog_time = (currentTime / duration) * 100;

                    progBar.style.width = `${prog_time}%`;

                    let minute = Math.floor(duration / 60);
                    let seconds = Math.floor(duration % 60);
                    let leadSec = seconds.toString().padStart(2, 0);

                    //total music duration
                    let totalDuration = `${minute}:${leadSec}`;
                    totalTime.textContent = totalDuration;
                    //current music duration
                    let curr_min = Math.floor(currentTime / 60);
                    let curr_sec = Math.floor(currentTime % 60)
                      .toString()
                      .padStart(2, 0);
                    let curr_duration = `${curr_min}:${curr_sec}`;
                    startTime.textContent = curr_duration;

                    //SIDE BAR SONG INDICATOR
                    part1.innerHTML = ` <div class="cover-image"><img src="${
                      data[index - loop].songimage
                    }" alt=""></div>
         <div class="cover-title">${data[index - loop].songname}</div>
         <div class="artist-name">${data[index - loop].artist}</div>`;
                  });
              });

              //PROGRESS BAR --->
              document
                .querySelector("audio")
                .addEventListener("timeupdate", function (event) {
                  const { currentTime, duration } = event.srcElement;

                  let prog_time = (currentTime / duration) * 100;

                  progBar.style.width = `${prog_time}%`;

                  let minute = Math.floor(duration / 60);
                  let seconds = Math.floor(duration % 60);
                  let leadSec = seconds.toString().padStart(2, 0);

                  //total music duration
                  let totalDuration = `${minute}:${leadSec}`;
                  totalTime.textContent = totalDuration;
                  //current music duration
                  let curr_min = Math.floor(currentTime / 60);
                  let curr_sec = Math.floor(currentTime % 60)
                    .toString()
                    .padStart(2, 0);
                  let curr_duration = `${curr_min}:${curr_sec}`;
                  startTime.textContent = curr_duration;

                  //SIDE BAR SONG INDICATOR
                  part1.innerHTML = ` <div class="cover-image"><img src="${data[index].songimage}" alt=""></div>
         <div class="cover-title">${data[index].songname}</div>
         <div class="artist-name">${data[index].artist}</div>`;
                });

              //MUSIC LOOP
            });
          });

          //LYRICS FEATURE
          // var lyrics = document.querySelector(".lyrics");
          // var lyricsArea = document.querySelector(".ly-area");
          //    var lybtn = document.querySelector("#lybtn");
          //    var l = 0;

          //    lybtn.addEventListener("click", function(){
          //      if(l === 0){
          //        var x = Math.floor(Math.random()*200)
          //        var y = Math.floor(Math.random()*200)
          //        var z = Math.floor(Math.random()*200)
          //          console.log("clicked")
          //        lyrics.style.display = "flex";
          //        document.querySelector(".lyrics").style.backgroundColor = `rgb(${x}, ${y}, ${z})`;
          //        lyricsArea.innerHTML += `<p>${data[index].lyrics}</p>`
          //        console.log(data[index].lyrics)
          //        l=1;
          //      }
          //      else{
          //        lyrics.style.display = "none";
          //        l=0;
          //      }

          //    })
        });
      });

      playbtn.addEventListener("click", function () {
        if (flag === 0) {
          playbtn.innerHTML = `<i class="ri-pause-circle-fill"></i>`;
          document.querySelector("audio").play();
          flag = 1;
        } else {
          playbtn.innerHTML = `<i class="ri-play-circle-fill"></i>`;
          document.querySelector("audio").pause();
          flag = 0;
        }
      });

      //PLAY ADS AFTER EVERY 3 SKIPS ---->

      var nextSong = 0;
      nextbtn.addEventListener("click", function () {
        nextSong++;
        if (nextSong === 4) {
          console.log("playing ad");

          nextSong = 0;
        }
      });

      //  document.querySelector("#likePage").addEventListener("click", function(){
      //   alert("This page is not yet build.")
      //  })

      //FLASH MESSAGE TIMEOUT SESSION
      var crtMsg = document.querySelector("#crtMessage");

      setTimeout(function () {
        crtMsg.style.display = "none";
      }, 1500);

      document.querySelector("#m-menu").addEventListener("click", function () {
        document.querySelector(".mobile-menu").style.left = "0";
      });
      document.querySelector("#close").addEventListener("click", function () {
        document.querySelector(".mobile-menu").style.left = "-100%";
      });

      window.addEventListener("load", function () {
        document.querySelector(".overlay").style.display = "flex";
        setTimeout(function () {
          document.querySelector(".overlay").style.display = "none";
        }, 5000);
      });

      document
        .querySelector(".popup>h5")
        .addEventListener("click", function () {
          document.querySelector(".overlay").style.display = "none";
        });



       

    </script>

    <script src="/javascripts/main.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
